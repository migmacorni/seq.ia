<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Polígono Interactivo a Pantalla Completa</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
        }
        #panel {
            width: 100%;
            height: 100%;
            background-color: #ccffcc; /* Color de fondo del panel */
            position: relative;
        }
        svg {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 0;
        }
        /* Estilo removido para .icono ya que usaremos una imagen */
        #eliminarPunto {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 2; /* Asegura que el botón esté sobre el SVG */
        }
    </style>
</head>
<body>

<div id="panel"><svg></svg></div>
<button id="eliminarPunto">Deshacer</button>

<script>
    var puntos = []; // Almacena todos los puntos

    // Añade esta función para definir el patrón con la imagen que se usará para llenar los círculos
    function definirPatronConImagen(svg) {
        var defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');
        var pattern = document.createElementNS('http://www.w3.org/2000/svg', 'pattern');
        pattern.setAttribute('id', 'imagenPunto');
        pattern.setAttribute('patternUnits', 'objectBoundingBox');
        pattern.setAttribute('width', '1');
        pattern.setAttribute('height', '1');
        pattern.setAttribute('viewBox', '0 0 100 100'); // Asegúrate de que esto corresponde a la relación de aspecto de tu imagen
        pattern.setAttribute('preserveAspectRatio', 'xMidYMid slice');

        var image = document.createElementNS('http://www.w3.org/2000/svg', 'image');
        image.setAttributeNS('http://www.w3.org/1999/xlink', 'href', 'logo.png'); // Ruta a tu imagen, asegúrate de que sea accesible
        image.setAttribute('width', 100);
        image.setAttribute('height', 100);
        pattern.appendChild(image);

        defs.appendChild(pattern);
        svg.appendChild(defs);
    }

    document.getElementById('panel').addEventListener('click', function(e) {
        // Posición del punto ajustada
        var rect = this.getBoundingClientRect();
        var x = e.clientX - rect.left;
        var y = e.clientY - rect.top;

        // Agregar el nuevo punto a la lista de puntos
        puntos.push({x, y});

        // Dibujar de nuevo todos los puntos, líneas, rellenar si es necesario, y cerrar el polígono
        dibujar();
    });

    document.getElementById('eliminarPunto').addEventListener('click', function() {
        // Eliminar el último punto
        puntos.pop();

        // Redibujar el polígono
        dibujar();
    });

    function dibujar() {
        var svg = document.querySelector('svg');
        svg.innerHTML = ''; // Limpiar el SVG para redibujar
        definirPatronConImagen(svg); // Definir el patrón antes de empezar a dibujar los círculos

        if (puntos.length > 2) {
            let pointsAttr = puntos.map(p => `${p.x},${p.y}`).join(' ');
            let poligono = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
            poligono.setAttribute('points', pointsAttr);
            poligono.setAttribute('fill', '#f0e68c'); // Marrón "tierra" ajustado//#8B4513
            svg.appendChild(poligono);
        }

        puntos.forEach(punto => {
            var circulo = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            circulo.setAttribute('class', 'icono');
            circulo.setAttribute('cx', punto.x);
            circulo.setAttribute('cy', punto.y);
            circulo.setAttribute('r', 5);
            svg.appendChild(circulo);
        });
        // Dibujar los círculos con la imagen dentro
        puntos.forEach(punto => {
            var circulo = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            circulo.setAttribute('cx', punto.x);
            circulo.setAttribute('cy', punto.y);
            circulo.setAttribute('r', 20); // Tamaño del círculo
            circulo.setAttribute('fill', 'url(#imagenPunto)'); // Usar la imagen como relleno
            svg.appendChild(circulo);
        });
    }
</script>

</body>
</html>
